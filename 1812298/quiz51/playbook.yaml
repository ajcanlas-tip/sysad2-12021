---
- name: Installs
  hosts: ubuntu

  tasks:
    - name: Install Docker file
      apt:
        name: docker.io
        state: latest
        update_cache: yes
        register: docker

    - name: Install docker.py
      pip:
        name: docker.py
        state: latest
        when: docker.changed

    - name: Pull Elasticsearch Image
      docker_image:
        name: docker.elastic.co/elasticsearch/elasticsearch:7.10.1

    - name: Creating Docker Network
      docker_network:
        name: elastic

    - name: Container for Elasticsearch
      docker_container:
        name: elasticsearch
        image: docker.elastic.co/elasticsearch/elasticsearch:7.10.1
        state: present
        ports:
          - "9200:9200"
          - "9300:9300"
        networks:
          - name: elastic

    - name: Pull Kibana Image
      docker_image:
        name: docker.elastic.co/kibana/kibana:7.10.1

    - name: Container for Kibana
      docker_container:
        name: kibana
        image: docker.elastic.co/kibana/kibana:7.10.1
        state: present
        ports: 
          - "5601:5601"
        networks:
          - name: elastic

    - name: Pull Logstash Image
      docker_image:
        name: docker.elastic.co/kibana/kibana:7.10.1

    - name: Container for Logstash
      docker_container:
        name: logstash
        image: docker.elastic.co/logstash/logstash:7.10.1
        state: present
        ports: 
          - "5044:5044"
        networks:
          - name: elastic
