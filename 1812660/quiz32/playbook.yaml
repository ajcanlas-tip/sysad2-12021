---
  - name: Step1 - Install Apache
    hosts: ubuntu

    tasks:
        - name: install apache2
          apt:
            name: apache2
            state: latest
            update_cache: yes

        - name: start apache2 service
          service:
            name: apache2
            state: started

  - name: Step2 Adjusting the Firewall
    hosts: ubuntu

    tasks:
        - name: whitelist apache2 in ufw
          ufw:
            rule: allow
            port: '80'
            proto: tcp

  - name: Step5 - Creating a Virtual Host for you Website
    hosts: ubuntu

    tasks:
      - name: Creating Virtual Host Directory
        file:
          path: /var/www/lucana_domain
          state: directory
          mode: '0755'
      
      - name: Copy index.html from files folder
        copy:
          src: index.html
          dest: /var/www/lucana_domain/index.html
          owner: rlucana-tip
          group: qrlucana-tip
          mode: '0755'

      - name: Copy lucana_domain.conf to sites-available
        copy:
          src: lucana_domain.conf
          dest: /etc/apache2/sites-available/lucana_domain.conf
          owner: rlucana-tip
          group: qrlucana-tip
          mode: '0755'

      - name: Enable New Virtual Host
        shell: a2ensite lucana_domain

      - name: Disable Default Website
        shell: a2dissite 000-default

      - name: Restart Apache2
        service:
          name: apache2
          state: restarted
