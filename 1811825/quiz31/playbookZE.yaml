- name: Install and Configure vsftpd service
  hosts: all


  tasks: 
   - name: apt update && apt install vsftpd
     apt: 
        name: vsftpd
        state: latest
        update_cache: yes

   - name: Stop firewall
     service: 
        name: ufw
        state: stopped
        enabled: no

   - name: create user
     user: 
        name: user1
        password: $5$p3d0EF3EfTTcWeUr$kSJEnPMF1YjJuCLezGsh1u7TJI8Xcgi8CoIx9n9

   - name: DenyUsers user1
     lineinfile: 
        path: /etc/ssh/sshd_config
        line: "DenyUsers user1"
     register: sshd_config

   - name: Restart SSHD
     service: 
       name: sshd
       state: restarted
     when: sshd_config.changed

   - name: Create folder
     file:
        path: /home/user1/ftp
        state: directory
        owner: nobody
        group: nogroup
        mode: '0555'

   - name: Create files
     file: 
        path: /home/user1/ftp/files
        state: directory
        owner: user1
        group: user1
    
   - name: render /etc/vsftpd.comf
     copy: 
        src: vsftpd.comf
        dest: /etc/vsftpd.conf
     register: vsftpd_config
    
   - name: Restart vsftpd
     service: 
         name: vsftpd
         state: restarted
     when: vsftpd_config.changed

