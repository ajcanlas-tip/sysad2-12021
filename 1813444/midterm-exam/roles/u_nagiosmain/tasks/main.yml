---
# tasks file for roles/u_nagiosmain

- name: extracting nagios core 
  unarchive: 
    src: https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.5.tar.gz 
    dest: /tmp 
    copy: no 

- name: nagios configuration
  command: ./configure --with-nagios-group=nagcmd --with-commad-group=nagcmd --with-httpd_conf=/etc/apache2/sites-enabled 
  args: 
    chdir: /tmp/nagios-4.4.5 

- name: make clean 
  make: 
    target: clean
    chdir: /tmp/nagios-4.4.5 

- name: make all 
  make: 
    target: all 
    chdir: /tmp/nagios-4.4.5 

- name: make install
  make:
    target: install
    chdir: /tmp/nagios-4.4.5 

- name: make install init
  make:
    target: install-init
    chdir: /tmp/nagios-4.4.5 

- name: make install config 
  make: 
    target: install-config 
    chdir: /tmp/nagios-4.4.5 

- name: make install commandmode 
  make: 
    target: install-commandmode 
    chdir: /tmp/nagios-4.4.5

- name: webconf 
  make: 
    target: install-webconf 
    chdir: /tmp/nagios-4.4.5 

- name: user authentication
  htpasswd: 
    path: /usr/local/nagios/etc/htpasswd.users
    name: "{{ username }}"
    password: "{{ password }}" 

- name: a2enmod cgi 
  command: a2enmod cgi 

- name: restart apache2
  service: 
    name: apache2
    state: restarted 

























