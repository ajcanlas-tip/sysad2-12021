---
# tasks file for roles/ent_serv

#debian
 - name: install vsftpd
   apt:
    name: vsftpd
    state: latest
    update_cache: yes
   when: ansible_distribution == "Debian"

 - name: stop firewall
   service:
    name: ufw
    state: stopped
    enabled: no
   when: ansible_distribution == "Debian"

 - name: create ftp user
   user:
    name: user
    password: '{{ftp_pass}}'
    comment: "ftp user"
   when: ansible_distribution == "Debian"

 - name: deny user
   lineinfile:
    path: /etc/ssh/sshd_config
    line: "DenyUsers user"
   register: ssh_config
   when: ansible_distribution == "Debian"

 - name: restart sshd
   service:
    name: sshd
    stete: restarted
   when: ssh_config.chenged
   when: ansible_distribution == "Debian"

 - name: make ftp directory
   file:
    path: /home/user/ftp
    state: directory
    owner: user
    group: group
    mode: '0555'
   when: ansible_distribution == "Debian"

 - name: create ftp files
   file:
    path: /home/user/ftp/files
    state: directory
    owner: user
    group: group
   when: ansible_distribution == "Debian"

 - name: copy vsftpd files
   copy:
    src: vsftpd.conf
    dest: /etc/vsftpd.conf
   register: vsftpd_config
   when: ansible_distribution == "Debian"

 - name: restart vsftpd
   service:
    name: vsftpd
    state: restarted
   when: vsftpd_config.changed
   when: ansible_distribution == "Debian"

#centos
 - name: install vsftpd
   yum:
    name: vsftpd
    state: latest
    update_cache: yes
   when: ansible_distribution == "CentOS"

 - name: stop firewall
   service:
    name: firewalld
    state: stopped
    enable: no
   when: ansible_distribution == "CentOS"

 - name: create ftp user
   user:
    name: user
    password: '{{ftp_pass}}'
    comment: "ftp user"
   when: ansible_distribution == "CentOS"

 - name: deny user
   lineinfile:
    path: /etc/ssh/sshd_config
    line: "DenyUser user"
   register: sshd_config
   when: ansible_distribution == "CentOS"

 - name: restart sshd
   service:
    name: sshd
    state: restarted
   when: sshd_config.changed
   when: ansible_distribution == "CentOS"

 - name: create ftp directory
   file:
    path: /home/user/ftp
    state: directory
    owner: user
    group: group
   when: ansible_distribution == "CentOS"

 - name: create file directory
   file:
    path: /home/user/ftp/files
    state: directory
    owner: user
    group: group
   when: ansible_distribution == "CentOS"

 - name: copy vsftpd files
   copt:
    src: vsftpd.conf
    dest: /etc/vsftpd.conf
   register: vsftpd_config
   when: ansible_distribution == "CentOS"
 
 - name: restart vsftpd
   service:
    name: vsftpd
    state: restarted
   when: vsftpd_config.changed
   when: ansible_distribution == "CentOS"

#opensuse
 - name: install vsftpd
   zypper:
    name: vsftpd
    state: latest
    update_cache: yes
   when: ansible_distribution == "openSUSE Tumbleweed"

 - name: stop firewall
   service:
    name: firewalld
    state: stopped
    enabled: no
   when: ansible_distribution == "openSUSE Tumbleweed"

 - name: create ftp user
   user:
    name: user
    password: '{{ ftp_pass }}'
    comment: "ftp user"
   when: ansible_distribution == "openSUSE Tumbleweed"

 - name: create ftp group
   group:
    name: group
   when: ansible_distribution == "openSUSE Tumbleweed"

 - name: deny user
   lineinfile:
    path: /etc/ssh/sshd_config
    line: "DenyUser user"
   register: sshd_config
   when: ansible_distribution == "openSUSE Tumbleweed"

 - name: restart sshd
   service:
    name: sshd
    state: restarted
   when: sshd_config.changed
   when: ansible_distribution == "openSUSE Tumbleweed"

 - name: create ftp directory
   file:
    path: /home/user/ftp
    state: directory
    owner: user
    group: group
   when: ansible_distribution == "openSUSE Tumbleweed"

 - name: create ftp files
   file:
    path: /home/user/ftp/files
    state: directory
    owner: user
    group: group
   when: ansible_distribution == "openSUSE Tumbleweed"

 -name: copy vsftpd files
  copy:
   src: vsftpd.conf
   dest: /etc/vsftpd.conf
  register: vsftpd_config
  when:ansible_distribution == "openSUSE Tumbleweed"

 - name: remove line
   lineinfile:
    path: /etc/vsftpd.conf
    regexp: 'secure_root_dir=/var/run/vsftpd/empty'
    line: ' '
   when: ansible_distribution == "openSUSE Tumbleweed"

 - name: restart vsftpd
   service:
    name: vsftpd
    state: restarted
   when: vsftpd_config.changed
   when: ansible_distribution == "openSUSE Tumbleweed"























































































































   
  
