---
# tasks file for roles/elas_ubun
 - name: install java
   apt:
    name:
     - openjdk-11-jdk
     - nginx
    state: latest
    update_cache: yes

 - name: install elastic rep
   apt_key:
    url: https:packages.elastic.co/GPG-KEY-elasticsearch
    state: present

 - name: install apt rep
   apt:
    name: apt-transport-https
    state: present
    update_cache: yes

 - name: install apt transport
   apt:
    name: apt-transport-https
    state: present

 - name: install elastic search
   apt:
    name: elasticsearch
    state: present
    update_cache: yes

 - name: update config host elas
   lineinfile:
    destfile: /etc/elasticsearch/elasticsearch.yml
    regexp: 'networl.host: '
    line: 'network.host: localhost'

 - name: update config port elas
   lineinfile:
    destfile: /etc/elasticsearch/elasticsearch.yml
    regexp: 'http.port: '
    line: 'http.port: 9200'

 - name: discovery type
   lineinfile:
    destfile:  /etc/elasticsearch/elasticsearch.yml
    line:  'discovery.type: single-node'

 - name: start elastic search
   service:
    name: elasticsearch
    state: started

 - name: install kibana
   apt:
    name: kibana
    state: present
    update_cache: yes

 - name: update config host kiba
   lineinfile:
    destfile: /etc/kibana/kibana.yml
    regexp: 'server.host: '
    line: 'server.host: localhost'

 - name: update config port kiba
   lineinfile:
    destfile: /etc/kibana/kibana.yml
    regexp: 'server.port: '
    line: 'server.port: 5601'

 - name: start kibana
   service:
    name: kibana
    state: started

 - name: install logstash
   apt:
    name: logstash
    state: present
    update_cache: yes

 - name: start logstash
   service:
    name: logstash
    state: started

