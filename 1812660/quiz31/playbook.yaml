---
  - name: Install and Configure FTP server in Ubuntu
    hosts: ubuntu

    tasks:
      - name: Ubuntu - Install vsftpd
        apt:
          name: vsftpd
          state: latest
          update_cache: yes

      - name: Ubuntu - Disable firewall
        service:
          name: ufw
          state: stopped
          enabled: no

      - name: Ubuntu -  Create FTP User
        user:
          name: ftp_user
          password: $5$3gaVpvoXNcPbqnmh$.y9KMW12SkRVe8NY3Y6ixhaY5Y5fyUE4kU0xC/Mlbs1
          comment: "FTP User"

      - name: Ubuntu - DenyUsers to /etc/ssh/sshd_config
        lineinfile:
          path: /etc/ssh/sshd_config
          line: "DenyUsers ftp_user"
        register: sshd_config

      - name: Ubuntu - sshd service restart
        service:
          name: sshd
          state: restarted
        when: sshd_config.changed

      - name: Ubuntu - Create FTP Directory
        file:
          path: /home/ftp_user/ftp/
          state: directory
          owner: nobody
          group: nogroup
          mode: "0555"

      - name: Ubuntu - Create Files Directory
        file:
          path: /home/ftp_user/ftp/files
          state: directory
          owner: ftp_user
          group: ftp_user

      - name: Ubuntu - Copy vsftpd.conf in /etc/vsftpd.conf
        copy:
          src: vsftpd.conf
          dest: /etc/vsftpd.conf
        register: vsftpd_config

      - name: Ubuntu - Restart vsftpd.conf
        service:
          name: vsftpd
          state: restarted
        when: vsftpd_config.changed

  - name: Install and Configure FTP server  in Centos
    hosts: centos

    tasks:
      - name: Install vsftpd
        yum:
          name: vsftpd
          state: latest
          update_cache: yes

      - name: Disable Firewall
        service:
          name: firewalld
          state: stopped
          enabled: no

      - name: Start vsftpd
        service:
          name: vsftpd
          state: started
          enabled: yes

      - name: Create FTP User
        user:
          name: ftp_user
          password: $5$OG5a6TJ9FT53n6xT$VZxj3s2bJmoAH1NhcCAHdQmmAkawWIFOvEgbR3uAx42
          comment: "FTP User"

      - name: Create FTP Directory
        file:
          path: /home/ftp_user/ftp
          state: directory
          owner: ftp_user
          group: ftp_user
          mode: '0750'

      - name: Copy vsftpd_centos.conf in /etc/vsftpd.conf
        copy:
          src: vsftpd_centos.conf
          dest: /etc/vsftpd.conf
        register: vsftpd_config
      
      - name: Restart vsftpd.conf
        service:
          name: vsftpd
          state: restarted
        when: vsftpd_config.changed
