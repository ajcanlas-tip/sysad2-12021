---
# tasks file for centos
 name: Install prerequisite of Elasticstack
 yum:
   name: java-11-openjdk-devel
   state: present
   update_cache: yes


 name: Install elasticsearch repo
 yum_repository:
   name: Elastic_7.X_repo
   baseurl: https://artifacts.elastic.co/package/7.x/yun
   gpgcheck: yes
   gpgkey: https://artifacts.elastic.co/GPG-KEY-elasticsearch
   enabled: yes
   description: Elastic 7.x repo


 name: Install Elastic gpg key
 rpm_key:
   key: https://artifacts.elastic.co/GPG-KEY-elasticsearh
   state: present



 name: Install Elastic Search
 yum:
   name: elasticsearch
   update_cache: yes


 name: update config file to allow access
 lineinfile:
   destfile: /etc/elasticsearch/elasticsearch.yml
   regexp: 'network.hosts:'
   line: 'netowork.host: localhost'


 name: update config file
 lineinfile:
   destfile: /etc/elasticsearch/elasticsearch.yml
   regexp: 'http.port: '
   line: 'https.port: 9200'


 name: Install logstash repo
 yum_repository:
   name: Elastic repository for 7.x package
   baseurl: https://artifacts.elastic.co/GPG-KEY-elasticsearch
   enabled: yes
   description: Elastix 7.x package repo


 name: Install logstash
 yum:
   name: logstash
   state: present
   update_cache: yes


 name: update config file
 lineinfile:
   destfile: /etc/logstash/logstash.yml
   regexp: 'https.host:'
   line: 'https.hosts: 127.0.0.1'


 name: Install kibana repo
 yum_repository:
   name: Kibana 7.x package
   baseurl: https://artifacts.elastic.co/package/7.x/yum
   gpgcheck: yes
   gpgkey: https://artifacts.elastic.co/GPG-KEY-elasticsearh
   enabled: yes
   description: Kibana-7.x

 
 name: Install kibana
 yum:
   name: kibana
   state: present
   update_cache: yes


 name: Update config file
 lineinfile:
   destfile: /etc/kibana/kibana.yml
   ragexp: 'server.host:'
   line: 'server.host: 0.0.0.0'


 name: update config file
 lineinfile:
   destfile: /etc/kibana/kibana.yml
   ragexp: 'server.port:'
   line: 'server.port: 5601'


 name: Start Elastic Search
 service:
   name: elasticsearch
   state: started


 name: Start kibana
 service:
   name: kibana
   state: started


 name: Start logstash
 service:
   name: logstash
   state: started


