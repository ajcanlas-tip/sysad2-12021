---
- name: Installing Apache, MySQL, PHP(LAMP) stack on Ubuntu 20.04
  hosts: ubuntu

  tasks:
    - name: Updating apt in UBUNTU
      apt:
        update_cache: YES

    - name: Installing Apache using Ubuntu's pakage manager
      apt:
        name: apache2
        state: latest

    - name: Start the apache2 service
      service:
        name: apache2
        state: started
        enabled: YES

    - name: whitelist apache2 in ufw
      ufw:
        rule: allow
        port: '80'
        proto: tcp
      loop:
        - 80
        - 22

- name: Check Web Service if up
  hosts: ubuntu
  connection: local

  tasks:
    - name: Check Web Service if up
      uri:
        url: http://{{ item }}/
      loop:
        - 10.0.2.15

- name: Installing MySQL
  hosts: ubuntu

  tasks:
    - name: Installing MySQL-Server
      apt:
        name: mysql-server
        state: latest

    - name: Start the mysql
      service:
        name: mysql
        state: started
        enabled: YES

- name: PHP Packages
  hosts: ubuntu

  tasks:
    - name: Installing PHP packages
      apt:
        name:
          - php
          - php-mysql
          - libapache2-mod-php

- name: Virtual Host for my Website
  hosts: ubuntu

  tasks:
    - name: HTML
      copy:
        content: " QUIZ 2.2 ABELONG "
        dest: /var/www/html/index.html
        owner: root
        group: root
        mode: '0644'

