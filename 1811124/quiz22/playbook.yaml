---
- name: Installing apache2 and updating the firewall 
  hosts: ubuntu

  tasks: 
  - name: Updating ubuntu packages
    apt: 
      update_cache: yes

  - name: Installing apache2
    apt: 
      name: apache2 
      state: present 

  - name: start apache2 service 
    service:
        name: apache2
        state: started
        enabled: yes

  - name: Allow all access to tcp port 80
    ufw: 
      rule: allow 
      port: '80'
      proto: tcp

  - name: Enable firewall
    ufw: 
      state: enabled

- name: Installing mysql packages
  hosts: ubuntu 

  tasks:
  - name: Installing mysql
    apt:
      name: mysql-server
      state: present

  - name: starting mysql server 
    service: 
      name: mysql
      state: started

- name: Installing PHP packages
  hosts: ubuntu 

  tasks: 
  - name: Installing php, library, and php-mysql
    apt:
      name:
        - php
        - libapache2-mod-php
        - php-mysql

- name: Creating a virtual host in the website
  hosts: ubuntu

  tasks:
  - name: create index.html 
    copy: 
      content: "<h1>Hello World!</h1><br>This is the <strong>iz me and my alpine</strong>"
      dest: /var/www/html/index.html
      owner: root 
      group: root 
      mode: '0644'

  - name: Allow access to tcp port 80
    ufw: 
      rule: allow 
      port: '80'
      proto: tcp

- name: Testing PHP Processing on the web server 
  hosts: ubuntu 

  tasks: 
  - name: Testing PHP 
    copy: 
      src: ./edit.html
      dest: /var/www/html/info.php
      owner: root 
      group: root 
      mode: '0644'
      
