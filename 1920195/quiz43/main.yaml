---
- hosts: all
  gather_facts: yes

  vars_files:
    - vars_file.yml

  tasks:
    - name: Disabling firewall on ubuntu
      service:
        name: ufw
        state: stopped
        enabled: no
      when: ansible_facts['os_family'] == 'Debian' or ansible_facts['os_family'] == 'Ubuntu'

    - name: Disabling firewall on centos
      service:
        name: firewalld
        state: stopped
        enabled: no
      when: ansible_facts['os_family'] == 'RedHat'

    - name: installing requirements on ubuntu
      become: yes
      apt:
        name: 
          - nginx
          - default-jre
        state: latest
        update_cache: yes
      when: ansible_distribution == 'Ubuntu' or ansible_distribution == 'Debian'

    - name: installing requirements on centos
      yum:
        name: 
          - java-1.8.0-openjdk
          - nginx
        state: latest
        update_cache: yes
      when: ansible_distribution == 'CentOs' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: Installing ElasticSearch,Logstash,Kibana (ELK)
  hosts: all
  tasks:
    - name: installing elasticsearch on ubuntu
      include_role:
        name: ubuntu-elast
      when: ansible_distribution == 'Ubuntu' or ansible_distribution == 'Debian'

    - name: installing kibana on ubuntu
      include_role:
        name: ubuntu-kib
      when: ansible_distribution == 'Ubuntu' or ansible_distribution == 'Debian'

    - name: installing logstash on ubuntu
      include_role:
        name: ubuntu-log
      when: ansible_distribution == 'Ubuntu' or ansible_distribution == 'Debian'
    
    - name: installing elasticsearch on centos
      include_role:
        name: centos-elast
      when: ansible_distribution == 'CentOs' or ansible_distribution == 'Red Hat Enterprise Linux'

    - name: installing kibana on centos
      include_role:
        name: centos-kib
      when: ansible_distribution == 'CentOs' or ansible_distribution == 'Red Hat Enterprise Linux'

    - name: installing logstash on centos
      include_role:
        name: centos-log
      when: ansible_distribution == 'CentOs' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: installing filebeat and elasticsearch configurations
  hosts: all
  roles:
    - filebeat
    - elast_node
    - elast_master
