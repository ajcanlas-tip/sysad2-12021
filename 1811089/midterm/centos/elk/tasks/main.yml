---
 - name: Java installation
   yum:
     name: java-1.8.0-openjdk
     state: present

 - name: Elastic key
   command: sudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch

 - name: Elastic repo
   copy:
     src: elasticsearch.repo
     dest: /etc/yum.repos.d/
     

 - name: Cache update
   dnf:
     update_cache: yes

 - name: Elasticsearch installation
   dnf:
     name: elasticsearch
     state: present

 - name: Uncomment http port
   replace:
     path: /etc/elasticsearch/elasticsearch.yml
     regexp: '#http.port: 9200'
     replace: 'http.port: 9200'

 - name: Uncomment network host
   replace:
     path: /etc/elasticsearch/elasticsearch.yml
     regexp: '#network.host '
     replace: 'network.host: localhost'

 - name: Kibana installation
   dnf:
     name: kibana  
     state: present

 - name: Uncomment server port
   replace:
     path: /etc/kibana/kibana.yml
     regexp: '#server.port: 5601'
     replace: 'server.port: 5601'

 - name: Uncomment localhost   
   replace:
     path: /etc/kibana/kibana.yml
     regexp: '#elasticsearch.host: ["http://localhost:9200"]'
     replace: 'elasticsearch.host: ["http://localhost:9200"]'

 - name: Service restart
   command: firewall-cmd --reload

 - name: Logstash installation
   dnf:
     name: logstash
     update_cache: yes

 - name: Logstash configuration
   copy:
     src: logstash.conf
     dest: /etc/logstash/conf.d/

 - name: Service startup
   service:
     name: elasticsearch
     state: started
     enabled: yes

 - name: Kibana service startup
   service:
     name: kibana
     state: started
     enabled: yes

 - name: Logstash service startup
   service:
     name: logstash
     state: started
     enabled: yes
# tasks file for centos/elk