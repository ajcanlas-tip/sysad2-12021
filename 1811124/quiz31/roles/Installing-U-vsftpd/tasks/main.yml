---
# tasks file for roles/Installing-U-vsftpd
  - name: Installing vsftpd
    apt:
      name: vsftpd
      state: latest 
      update_cache: yes

  - name: Change the state of firewall
    service: 
      name: ufw
      state: stopped
      enabled: no 

  - name: Create ftp user
    become: yes
    user:
      name: emd
      password: $6$SK./oxyZ81cC$3DKwoHyPg5JvZ0sgx.2O9Edtic2eCJs2bmknKDo81GVYNzpx1uC/Wb6CAQH6g7bDsnZEs/AfimJcFpbYWXYKQ1 
      comment: "User of emd's FTP" 

  - name: Denying ftp user
    become: yes
    lineinfile:
      path: /etc/ssh/sshd_config
      line: "DenyUser emd"
    register: sshd_config

  - name: Restarting sshd service
    become: yes
    service:
      name: sshd
      state: restarted
    when: sshd_config.changed

  - name: Creating ftp folder 
    file: 
      path: /home/emd/ftp
      state: directory
      owner: nobody
      group: nogroup
      mode: '0555'

  - name: Creating files in ftp 
    file: 
      path: /home/emd/ftp/files
      state: directory 
      owner: emd
      group: emd
  
  - name: Copying to vsftpd.conf
    copy:
      src: vsftpd.conf
      dest: /etc/vsftpd.conf
    register: vsftpd_config

  - name: Restart vsftpd.conf
    service: 
      name: vsftpd
      state: restarted
    when: vsftpd_config.changed
