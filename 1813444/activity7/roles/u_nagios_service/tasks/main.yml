---
# tasks file for roles/u_nagios_service

- name: installation of ubuntu packages 
  apt: 
    name: 
      - apache2
      - apache2-utils
      - build-essential
      - daemon
      - libapache2-mod-php 
      - libgd-dev 
      - libperl-dev 
      - libssl-dev 
      - make
      - openssl 
      - perl
      - php 
      - php-gd
      - unzip 
      - wget 
    state: latest 
    update_cache: yes 

- name: group nagcmd 
  group: 
    name: nagcmd 
    state: present 

- name: user nagios 
  user: 
    name: nagios
    group: nagcmd

- name: nagios core
  unarchive: 
    src: https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.5.tar.gz 
    dest: /tmp 
    copy: no 

- name: configuring nagios 
  command: ./configure --with-nagios-group=nagcmd --with-command-group-nagcmd --with-httpd_conf=/etc/apache2/sites-enabled 
  args: 
    chdir: /tmp/nagios-4.4.5

- name: nagios clean
  make: 
    target: clean 
    chdir: /tmp/nagios-4.4.5 

- name: nagios compilation
  make: 
    target: all 
    chdir: /tmp/nagios-4.4.5

- name: install nagios compilation
  make:
    target: install
    chdir: /tmp/nagios-4.4.5

- name: nagios init
  make:
    target: install-init
    chdir: /tmp/nagios-4.4.5 

- name: nagios config
  make: 
    target: install-config 
    chdir: /tmp/nagios-4.4.5

- name: nagios commandmode 
  make: 
    target: install-commandmode 
    chdir: /tmp/nagios-4.4.5 

- name: webconf 
  make: 
    target: install-webconf 
    chdir: /tmp/nagios-4.4.5 

- name: user 
  htpasswd: 
    path: /usr/local/nagios/etc/htpasswd.users 
    name: user
    password: password

- name: a2enmod cgi 
  command: a2enmod cgi 

- name: restarting apache2 
  service: 
    name: apache2
    state: restarted 































