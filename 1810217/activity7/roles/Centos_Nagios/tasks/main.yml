---
# tasks file for Centos_Nagios
 - name: Installing Dependencies
   yum:
     name:
       - compat-openssl10
       - perl
       - gcc
       - glibc
       - glibc-common
       - unzip
       - php
       - gd
       - gd-devel
       - postfix
     state: present

 - name: Add group in Nagios
   group:
     name: naggroup
     state: present

 - name: Add user in Nagios
   user:
     name: naguser
     group: naggroup

 - name: Installing Nagios
   unarchive:
     src: https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.5.tar.gz
     dest: /tmp
     remote_src: YES

 - name: Configure Nagios
   command: ./configure --with-command-group=naggroup
   args:
     chdir: /tmp/nagios-4.4.5

 - name: Make Clean
   make:
     target: clean
     chdir: /tmp/nagios-4.4.5

 - name: Make All
   make:
     target: all
     chdir: /tmp/nagios-4.4.5

 - name: Make Install-init
   make:
     target: install-init
     chdir: /tmp/nagios-4.4.5

 - name: Make Install-webconf
   make:
     target: install-webconf
     chdir: /tmp/nagios-4.4.5

 - name: Installing passlib
   pip:
     name: passlib

 - name: Creating User in Nagios
   htpasswd:
     path: /usr/local/nagios/etc/htpasswd.users
     name: user
     password: password

 - name: Restarting httpd
   service:
     name: httpd
     state: restarted
     enabled: YES

