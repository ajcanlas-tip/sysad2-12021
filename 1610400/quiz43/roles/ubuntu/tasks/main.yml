---
# tasks file for ubuntu

 name: Install prerequisite of the Elastic Stack
 apt:
   name:
     - openjdk-11-jdk
     - nginx
   state: latest
   update_cache: yes


 name: add Elasticsearch apt key
 apt_key:
   url: "https://package.elastic.co/GPG-KEY-elasticsearch"
   state: present


 name: Install APT repo
 apt:
   name: apt-transport-https
   state: present


 name: Adding Elasticsearch repo
 apt_repository:
   filename: elastic-7.x
   repo: deb https://artifacts.elastic.co/package/7.x/apt stable main
   state: present


 name: Install ElasticSearh
 apt:
   name: elasticsearch
   update_cache: yes


 name: Updating the config file to allow outside access
 lineinfile:
   destfile: /etc/elasticsearch/elasticsearch.yml
   regexp: 'network.host:'
   line: 'network.host: localhost'


 name: updating the port in config file
 lineinfile:
   destfile: /etc/elasticsearch/elasticsearch.yml
   regexp: 'http,port:'
   line: 'http,port: 9200'


 name: Install Kibana
 apt:
   name: kibana
   update_cache: yes


 name: Updating the config file to allow access
 lineinfile:
   destfile: /etc/kibana/kibana.yml
   regexp: 'server.host:'
   line: 'server.host: localhost'


 name: Defining server port
 lineinfile:
   destfile: /etc/kibana/kibana.yml
   regexp: 'server.hosts:'
   line: 'server.host: localhost'


 name: Defining server port
 lineinfile:
   destfile: /etc/kibana/kibana.yml
   regexp: 'server.port'
   line: 'server.port: 5601'


 name: defininf elasticsearch url
 lineinfile:
   destfile: /etc/kibana/kibana.yml
   regexp: 'elasticsearch.url:'
   line: 'elasticsearch.url: "https://localhost:9200" '


 name: Install Filebeat
 apt:
   name: filebeat
   update_cache: yes

 
 name: Install Logstash
 apt:
   name: logstash
   update_cache: yes


 name: Start logstash
 service:
   name: logstash
   state: started

