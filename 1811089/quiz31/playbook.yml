---
 - name: FTP Server Installation
   hosts: ubuntu

   tasks:
   - name: Vsftp Installtion
     apt:
       name: vsftpd
       state: latest
       update_cache: yes

   - name: Stop firewall
     service:
       name: ufw
       state: stopped
       enabled: no

   - name: Ftp user
     user:
       name: ocampo_ftp
       password: $5$HbgppPKunH7VdPHI$RL3iAWVYL87HGWhKHZhT/ic6Of90TAw3Y1.66.qu9s5
       comment: "ocampo_ftp"

   - name: Add DenyUsers
     lineinfile:
       path: /etc/ssh/sshd_config
       line: "DenyUsers ocampo_ftp"
     register: sshd_config

   - name: Restart sshd service
     service:
       name: sshd
       state: restarted
     when: sshd_config.changed

   -  name: Create ftp directory
      file:
        path: /home/ocampo_ftp
        state: directory
        owner: nobody
        group: nogroup
        mode: '0555'

   - name: Create files directory
     file:
       path: /home/ocampo_ftp/files
       state: directory
       owner: ocampo_ftp
       group: ocampo_ftp

   - name: Copy vsftpd.conf
     copy:
       src: vsftpd.conf
       dest: /etc/vsftpd.conf
     register: vsftpd_config

   - name: Restart vsftpd.conf
     service:
       name: vsftpd
       state: restarted
     when: vsftpd_config.changed
