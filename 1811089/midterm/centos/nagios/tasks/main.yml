---
 - name: Downloading required packages
   yum:
     name:
       - gcc
       - glibc
       - glibc-common
       - perl
       - gd-devel
       - postfix
       - unzip
       - httpd
     state: present

 - name: Start httpd service
   service:
     name: httpd
     state: started

 - name: Nagios Core
   get_url:
     url: https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.5.tar.gz
     dest: /tmp

 - name: Nagios Core extraction
   unarchive:
     src: /tmp/nagios-4.4.5.tar.gz
     dest: /tmp
     remote_src: yes

 - name: Groups
   become: yes
   group:
     name: naggroup
     state: present

 - name: Users
   become: yes
   user:
     name: naguser
     group: naggroup

 - name: Nagios configuration
   become: yes
   command: ./configure --with-command-group=naggroup --with-httpd_conf=/etc/httpd/conf.d
   args:
     chdir: /tmp/nagios-4.4.5

 - name: Clean
   become: yes
   make:
     target: clean
     chdir: /tmp/nagios-4.4.5

 - name: Make all
   become: yes
   make:
     target: all
     chdir: /tmp/nagios-4.4.5

 - name: Create systemd unit file
   become: yes
   make:
     target: install-daemoninit
     chdir: /tmp/nagios-4.4.5

 - name: Apache config. files
   make:
     chdir: /tmp/nagios-4.4.5
     target: install-webconf
   become: yes

 - name: Htpasswd module
   pip:
     name: passlib
     state: latest

 - name: Httpd service reboot
   service:
     name: httpd
     state: restarted

# tasks file for centos/nagios