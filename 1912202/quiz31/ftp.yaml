---
- name: Installation of vsftpd Service
  hosts: ubuntu

  tasks:
  - name: apt update && apt install vsftpd
    apt:
      name: vsftpd
      state: latest
      update_cache: yes

  - name: Stop firewall
    service:
      name: ufw
      state: stopped
      enabled: no

  - name: FTP user
    user:
       name: qcampnapone
       password: password
       comment: Christine Angel Mae P Napone

  - name: DenyUser qcamnapone
    lineinfile:
       path: /etc/ssh/sshd_config
       line: "DenyUsers qcamnapone"
    register: sshd_config

  - name: SSHD Service Restart
    service:
       name: sshd
       state: restarted
    when: sshd_config.changed

  - name: Creating FTP Folder
    file:
       path: /home/qcamnapone
       state: directory
       owner: nobody
       group: nogroup
       mode: '0555'

  - name: Create files folder
    file: 
       path: /home/qcamnapone/files
       state: directory
       owner: qcamnapone
       group: qcamnapone
 
  - name: vsftpd.conf copy
    copy:
       src: vsftpd.conf
       dest: /etc/vsftpd.conf
    register: vsftpd_config

  - name: vsftpd.conf restart
    service:
       name: vsftpd
       state: restarted
    when: vsftpd_config.changed
