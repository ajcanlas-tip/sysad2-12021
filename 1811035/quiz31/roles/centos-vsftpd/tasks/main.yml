---
# tasks file for roles/centos-vsftpd

- name: Installing VSFTPD
  become: yes
  yum:
    name: vsftpd
    state: present
    update_cache: yes

- name: uncomplicated firewall
  become: yes
  service:
    name: firewalld
    state: stopped
    enabled: no

- name: create ftpuser
  become: yes
  user:
    name: karl
    password: $1$0.pEK8GJ$CHCchzre7VXWcni0bBdxc/
    comment: "Ftp User"

- name: add denyuser
  become: yes
  lineinfile:
    path: /etc/ssh/ssh_config
    line: "DenyUser karl"
  register: ssh_config

- name: restart sshd service
  service:
    name: sshd
    state: restarted
  when: ssh_config.changed

- name: create ftpdir
  become: yes
  file:
    path: /home/karl/ftp
    state: directory
    owner: karl
    group: karl
    mode: '0555'

- name: files in directory
  become: yes
  file:
    path: /home/karl/ftp/files
    state: directory
    owner: karl
    group: karl

- name: copy vsftpd.conf
  become: yes
  copy:
    src: vsftpd.conf
    dest: /etc/vsftpd.conf
  register: vsftpd_config

- name: restart vsftpd
  become: yes
  service:
    name: vsftpd
    state: restarted
  when: vsftpd_config.changed

