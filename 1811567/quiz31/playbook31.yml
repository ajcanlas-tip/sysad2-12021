---
 - name: FTP Server Installation
   hosts: ubuntu

   tasks:
   - name: vsftp installation
     apt:
       name: vsftpd
       state: latest
       update_cache: yes

   - name: stop firewall
     service:
       name: ufw
       state: stopped
       enabled: no

   - name: Create ftp user
     user:
       name: create_user
       password: $5$UUJOJbVS3hgDU5BG$Ax54y11SR3gWmcEM0qD.SvbFwXkxF3Vv2zSSfMdJw53
       comment: "create_user"

   - name: Adding DenyUsers
     lineinfile:
       path: /etc/ssh/sshd_config
       line: "DenyUsers create_user"
     register: sshd_config

   - name: Restart sshd
     service:
       name: sshd
       state: restarted
     when: sshd_config.changed

   -  name: Create ftp directory
      file:
        path: /home/create_user
        state: directory
        owner: nobody
        group: nogroup
        mode: '0555'

   - name: Create files directory
     file:
       path: /home/create_user/files
       state: directory
       owner: create_user
       group: create_user

   - name: Copy vsftpd.conf
     copy:
       src: vsftpd.conf
       dest: /etc/vsftpd.conf
     register: vsftpd_config

   - name: Restart vsftpd.conf
     service:
       name: vsftpd
       state: restarted
     when: vsftpd_config.changed
