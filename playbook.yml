---
- name: Installation of vsftpd server
  hosts: Ubuntu
  tasks:
    - name: Installation for RedHad distributions
      yum:
        name: vsftpd
        state: latest
        update_cache: yes
      when: ansible_facts['os_family'] == 'RedHat'

    - name: Installation for Debian distribution
      apt:
        name: vsftpd
        state: latest
        update_cache: yes
      when: ansible_facts['os_family'] == 'Debian'

- name: Configuration of firewall
  hosts: Ubuntu
  tasks:
  - name: Cancellation of firewall on services for Ubuntu
    service:
      name: ufw
      state: stopped
      enabled: no
    when: ansible_facts['os_family'] == 'Debian'
  - name: Cancellation of firewall on services for CentOs
    service:
      name: firewalld
      state: stopped
      enabled: no
    when: ansible_facts['os_family'] == 'RedHat'

- name: Configuration of the vsftpd service for Ubuntu
  hosts: Ubuntu
  vars:
    name: qzkmcruz
    password: qzkmcruz
    user_comment: "First User"
  tasks:
    - name: Start and enable vsftpd
      service:
        name: vsftpd
        state: started
        enabled: yes

    - name: Create the user for FTP
      user:
        name: qzkmcruz
        password: password
        comment: "First User"
    - name: Adding DenyUser in sshd config
      lineinfile:
        path: /etc/ssh/sshd_config
        line: "DenyUsers"
      register: sshd_config
    - name: Restarting sshd services
      service:
        name: sshd
        state: restarted
      when: sshd_config.changed
    - name: Creation of FTP directory
      file:
        path: "/home//ftp"
        state: directory
        owner: qzkmcruz
        group: nogroup
        mode: "0777"
    - name: Creation of destination directory
      file:
        path: "/home//ftp/files"
        state: directory
        owner: qzkmcruz
        group: nogroup

    - name: Replication of vsftpd.conf
      copy: 
        src: Ubuntu-vsftpd.conf
        dest: /etc/vsfptd.conf
      register: vsftpd_conf
    - name: Restart of vsftpd service
      service:
        name: vsftpd
        state: restarted
      when: vsftpd_conf.changed


