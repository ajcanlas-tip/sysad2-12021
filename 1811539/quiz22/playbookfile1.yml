---
- name: Ubuntu Installation
  hosts: ubuntu
  vars_files: 
   - group_vars/varfiles

  tasks:

   - name: Ubuntu update of packages
     apt:
      update_cache: yes

   - name: Establishing APACHE
     apt:
      name: apache2
      state: latest

   - name: APACHE version verification
     shell: apache2 -v
     register: apachev

   - name: Results
     debug:
       msg: "{{ apachev.stdout }}"
   - name: Enable the HTTP Traffic
     ufw:
      rule: allow
      direction: in
      name: Apache

- name: Establishing MySQL Packages
  hosts: ubuntu
  vars_files: 
   - group_vars/varfiles
  

  tasks:

   - name: MySQL installation
     apt:
      name: mysql-server
      state: latest

   - name: Establishing MySQL-Python
     apt:
      name: python3-mysqldb
      state: latest

   - name: MySQL Begin
     service:
      name: mysql
      state: started
      enabled: true

   - name: Executing the secure Installation, Setting MySQL root pass
     mysql_user:
      login_host: 'localhost'
      login_user: 'root'
      login_password: ''
      name: 'root'
      password: '{{ pass_word }}'
      state: present


   - name: Executing the secure installation for removing MySQL test database
     mysql_user:
      login_user: 'root'
      login_password: '{{ pass_word }}'
      name: ''
      host: localhost
      state: absent

   - name: Executing again secure installation for the test database
     mysql_db:
      login_user: 'root'
      login_password: '{{ pass_word }}'
      name: test
      state: absent
   - name: Verifying MySQL version
     shell: mysql --version
     register: mysqlv

   - name: Result
     debug:
       msg: "{{ mysqlv.stdout }}"

- name: PHP Packages establishing
  hosts: ubuntu
  vars_files: 
   - group_vars/varfiles

  tasks:

  - name: Install PHP
    apt:
     name:
      - php
      - libapache2-mod-php
      - php-mysql

  - name: Verifying the PHP version
    shell: php -v
    register: phpv

  - name: Results
    debug:
      msg: "{{ phpv.stdout }}"


